{% comment %}
  LOBBY V7.2: CLEAN ARCHITECT
  - Removed: Gravity Gradient & Noise
  - Added: Solid Background Color Picker
  - Features: Manual Padding, Arch/Square Toggle, Deco Border Toggle
{% endcomment %}

{% schema %}
{
  "name": "ğŸ”® Lobby (V7.2 Clean)",
  "settings": [
    {
      "type": "header",
      "content": "ğŸ¨ èƒŒæ™¯ä¸å¸ƒå±€"
    },
    {
      "type": "color",
      "id": "bg_color",
      "label": "èƒŒæ™¯é¢œè‰²",
      "default": "#000000",
      "info": "ç§»é™¤å¼•åŠ›åœºåï¼Œç”±æ­¤æ§åˆ¶èƒŒæ™¯ã€‚"
    },
    {
      "type": "range",
      "id": "padding_top",
      "label": "é¡¶éƒ¨è¾¹è· (Padding Top)",
      "min": 0,
      "max": 200,
      "step": 4,
      "default": 60,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "label": "åº•éƒ¨è¾¹è· (Padding Bottom)",
      "min": 0,
      "max": 200,
      "step": 4,
      "default": 60,
      "unit": "px"
    },
    {
      "type": "header",
      "content": "ğŸ“ å†…å®¹è®¾ç½®"
    },
    {
      "type": "text",
      "id": "title",
      "label": "å¤§å…æ ‡é¢˜",
      "default": "CHOOSE YOUR PATH"
    },
    {
      "type": "header",
      "content": "ğŸ“ å¡ç‰‡å°ºå¯¸"
    },
    {
      "type": "range",
      "id": "card_scale",
      "label": "å¡ç‰‡å°ºå¯¸ç¼©æ”¾",
      "min": 0.5,
      "max": 1.5,
      "step": 0.1,
      "default": 1.0,
      "info": "åŸºå‡†å°ºå¯¸ 240x360px"
    },
    {
      "type": "range",
      "id": "grid_gap",
      "label": "å¡ç‰‡é—´è·",
      "min": 20,
      "max": 100,
      "step": 5,
      "default": 40,
      "unit": "px"
    },
    {
      "type": "header",
      "content": "ğŸ›ï¸ å¡ç‰‡å½¢æ€ä¸è®¾è®¡ (Card Architecture)"
    },
    {
      "type": "checkbox",
      "id": "enable_arch_shape",
      "label": "å¼€å¯æ‹±é—¨å½¢æ€ (Arch Shape)",
      "default": false,
      "info": "å°†å¡ç‰‡é¡¶éƒ¨å˜ä¸ºåŠåœ†å½¢ã€‚å…³é—­åˆ™ä¸ºæ–¹å½¢ã€‚"
    },
    {
      "type": "checkbox",
      "id": "enable_deco_border",
      "label": "å¼€å¯é¥°é‡‘è¾¹æ¡† (Deco Frame)",
      "default": false,
      "info": "æ·»åŠ å†…åµŒçš„åŒå±‚è®¾è®¡æ„Ÿè¾¹æ¡†ï¼Œé€‚é…ä»»ä½•å½¢çŠ¶ã€‚"
    },
    {
      "type": "range",
      "id": "card_radius",
      "label": "åŸºç¡€åœ†è§’åŠå¾„",
      "min": 0,
      "max": 40,
      "step": 2,
      "default": 12,
      "unit": "px",
      "info": "æ‹±é—¨æ¨¡å¼ä¸‹ä»…å½±å“åº•éƒ¨åœ†è§’ã€‚"
    },
    {
      "type": "header",
      "content": "ğŸ’¡ è§†è§‰ä¸å…‰æ•ˆ"
    },
    {
      "type": "checkbox",
      "id": "enable_bw_idle",
      "label": "é™æ­¢æ—¶é»‘ç™½ (Grayscale Idle)",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "enable_breathing",
      "label": "å¼€å¯è‡ªåŠ¨å‘¼å¸ (Auto Breathing)",
      "default": true
    },
    {
      "type": "range",
      "id": "glow_opacity",
      "label": "å‘¼å¸å…‰æœ€å¤§ä¸é€æ˜åº¦ (å¼ºåº¦)",
      "min": 20,
      "max": 100,
      "step": 10,
      "default": 60,
      "unit": "%"
    },
    {
      "type": "range",
      "id": "glow_spread",
      "label": "å‘¼å¸å…‰æ‰©æ•£èŒƒå›´",
      "min": 10,
      "max": 80,
      "step": 5,
      "default": 35,
      "unit": "px"
    }
  ],
  "blocks": [
    {
      "type": "chamber_slot",
      "name": "ğŸ”® å¯†å®¤å¡æ§½",
      "settings": [
        {
          "type": "metaobject",
          "id": "target_chamber",
          "label": "é€‰æ‹©ä¸€ä¸ª Oracle Chamber æ¡ç›®",
          "metaobject_type": "oracle_chamber"
        },
        {
          "type": "text",
          "id": "custom_label",
          "label": "è‡ªå®šä¹‰è¦†ç›–åç§° (é€‰å¡«)",
          "info": "è‹¥ä¸å¡«ï¼Œé»˜è®¤æ˜¾ç¤ºå…ƒå¯¹è±¡åŸæœ¬çš„åå­—"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "ğŸ”® Lobby (V7.2 Clean)",
      "blocks": [
        { "type": "chamber_slot" },
        { "type": "chamber_slot" },
        { "type": "chamber_slot" }
      ]
    }
  ]
}
{% endschema %}

{%- style -%}
  #shopify-section-{{ section.id }} {
    /* å¸ƒå±€å˜é‡ */
    --lobby-gap: {{ section.settings.grid_gap }}px;
    --card-scale: {{ section.settings.card_scale }};
    --card-width: calc(240px * var(--card-scale));
    --card-height: calc(360px * var(--card-scale));
    
    /* é—´è·ä¸èƒŒæ™¯ */
    --pad-top: {{ section.settings.padding_top }}px;
    --pad-bottom: {{ section.settings.padding_bottom }}px;
    --section-bg: {{ section.settings.bg_color }};
    
    /* æ§åˆ¶å˜é‡ */
    --card-base-radius: {{ section.settings.card_radius }}px;
    --glow-spread: {{ section.settings.glow_spread }}px;
  }

  /* å‘¼å¸åŠ¨ç”» */
  @keyframes lobbyBreath {
    0%, 100% {
      box-shadow: 0 0 0 transparent;
      border-color: var(--theme-dim);
    }
    50% {
      box-shadow: 0 0 var(--glow-spread) var(--theme-glow);
      border-color: var(--theme-color);
    }
  }

  /* [ å®¹å™¨ï¼šçº¯å‡€ç‰ˆ ] */
  .lobby-container {
    position: relative;
    width: 100%; /* é€‚é…é¡µé¢å®½åº¦ */
    background: var(--section-bg); /* ç”¨æˆ·è‡ªå®šä¹‰èƒŒæ™¯è‰² */
    
    /* ç›´æ¥æ§åˆ¶ç»„å—è¾¹è· */
    padding-top: var(--pad-top);
    padding-bottom: var(--pad-bottom);
    padding-left: 20px;
    padding-right: 20px;

    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
  }

  .lobby-title {
    position: relative; z-index: 2;
    font-family: serif; font-size: 2.5rem; color: #D4AF37; margin-bottom: 60px; letter-spacing: 0.2em;
    text-shadow: 0 0 20px rgba(212, 175, 55, 0.5); text-transform: uppercase; text-align: center;
  }
  
  .chamber-grid {
    position: relative; z-index: 2;
    display: flex; flex-wrap: wrap; justify-content: center; 
    gap: var(--lobby-gap); 
    max-width: 1600px; width: 100%;
  }

  /* === å¡ç‰‡æ ¸å¿ƒå®¹å™¨ === */
  .chamber-card {
    position: relative;
    width: var(--card-width); 
    height: var(--card-height); 
    border: 1px solid #333; /* é»˜è®¤è¾¹æ¡† */
    overflow: hidden;
    cursor: pointer;
    text-decoration: none;
    transition: transform 0.6s cubic-bezier(0.2, 0.8, 0.2, 1), box-shadow 0.4s ease, border-color 0.4s ease;
    background: #050505;
    
    /* é»˜è®¤åœ†è§’ (æ–¹å½¢æ¨¡å¼) */
    border-radius: var(--card-base-radius);
  }

  /* [ ğŸ›ï¸ å½¢æ€æ§åˆ¶ï¼šæ‹±é—¨ ] */
  .chamber-card.is-arch {
    /* é¡¶éƒ¨å˜åœ†ï¼Œåº•éƒ¨ä¿æŒåŸºç¡€åœ†è§’ */
    border-radius: 120px 120px var(--card-base-radius) var(--card-base-radius);
  }

  /* [ âœ¨ è¾¹æ¡†è®¾è®¡ï¼šåŒå±‚é¥°é‡‘çº¿æ¡† ] */
  /* å½“å¼€å¯è®¾è®¡æ„Ÿè¾¹æ¡†æ—¶ï¼Œéšè—é»˜è®¤è¾¹æ¡†ä»¥é¿å…å†²çª */
  .chamber-card.has-deco {
    border-color: transparent; 
    background-clip: padding-box;
  }
  
  /* å¤–å±‚è¾¹æ¡† (ç”± ::before æ¨¡æ‹Ÿ) */
  .chamber-card.has-deco::before {
    content: ""; position: absolute; inset: 0;
    border-radius: inherit; /* ç»§æ‰¿å½¢çŠ¶ */
    border: 1px solid var(--theme-dim);
    pointer-events: none; z-index: 3;
    transition: border-color 0.4s;
  }

  /* å†…å±‚æ‚¬æµ®é‡‘çº¿ (ç”± ::after æ¨¡æ‹Ÿ) */
  .chamber-card.has-deco::after {
    content: ""; position: absolute; 
    inset: 6px; /* å‘å†…ç¼©è¿› */
    border-radius: inherit; /* ç»§æ‰¿å½¢çŠ¶ */
    border: 1px double var(--theme-color); 
    opacity: 0.4;
    pointer-events: none; z-index: 3;
    transition: all 0.5s ease;
  }

  /* å‘¼å¸é€»è¾‘ (é€‚é…æ–°è¾¹æ¡†ç»“æ„) */
  {% if section.settings.enable_breathing %}
    /* æ— è®¾è®¡è¾¹æ¡†æ—¶çš„å‘¼å¸ */
    .chamber-card:not(.has-deco):not(:hover) {
      animation: lobbyBreath var(--breath-duration) ease-in-out infinite;
    }
    /* æœ‰è®¾è®¡è¾¹æ¡†æ—¶çš„å‘¼å¸ (ä½œç”¨äº before) */
    .chamber-card.has-deco:not(:hover)::before {
      animation: lobbyBreath var(--breath-duration) ease-in-out infinite;
    }
  {% endif %}

  /* === æ‚¬åœç‰¹æ•ˆ === */
  .chamber-card:hover {
    transform: translateY(-15px);
    box-shadow: 0 20px 60px rgba(0,0,0,0.9), 0 0 var(--glow-spread) var(--theme-glow);
    /* æ— è®¾è®¡è¾¹æ¡†æ—¶ç›´æ¥å˜è‰² */
    border-color: var(--theme-color);
  }
  
  /* æœ‰è®¾è®¡è¾¹æ¡†æ—¶çš„æ‚¬åœ */
  .chamber-card.has-deco:hover::before {
    border-color: var(--theme-color);
    animation: none;
  }
  .chamber-card.has-deco:hover::after {
    inset: 4px; /* å†…éƒ¨çº¿æ¡†å‘å¤–æ‰©å¼  */
    opacity: 1;
    border-width: 1px;
    box-shadow: inset 0 0 10px var(--theme-dim);
  }

  /* å›¾ç‰‡å±‚ */
  .chamber-img {
    width: 100%; height: 100%; object-fit: cover; 
    transition: 0.8s ease;
    {% if section.settings.enable_bw_idle %}
      opacity: 0.5; filter: grayscale(100%) contrast(1.2);
    {% else %}
      opacity: 0.8; filter: grayscale(0%) contrast(1.1) brightness(0.8);
    {% endif %}
  }
  .chamber-card:hover .chamber-img { 
    opacity: 1; filter: grayscale(0%) contrast(1.1) brightness(1.1); 
    transform: scale(1.1);
  }

  /* æ–‡å­—å±‚ */
  .chamber-info {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    display: flex; flex-direction: column; justify-content: center; align-items: center;
    z-index: 4; pointer-events: none; padding: 20px;
  }
  .chamber-name {
    color: #fff; font-family: sans-serif; letter-spacing: 0.3em; text-transform: uppercase;
    font-size: 0.9rem; text-align: center; margin-top: 20px;
    text-shadow: 0 2px 10px #000; transition: 0.4s;
  }
  .chamber-sigil-icon {
    font-size: 24px; color: #fff; opacity: 0.5; margin-bottom: 10px; transition: 0.4s;
  }
  .chamber-card:hover .chamber-name { letter-spacing: 0.4em; color: var(--theme-color); }
  .chamber-card:hover .chamber-sigil-icon { opacity: 1; color: var(--theme-color); transform: scale(1.2); }

{%- endstyle -%}

<div class="lobby-container">
  {% if section.settings.title != blank %}
    <h1 class="lobby-title">{{ section.settings.title }}</h1>
  {% endif %}
  
  <div class="chamber-grid">
    
    {% for block in section.blocks %}
      {% assign room = block.settings.target_chamber %}
      
      {% if room != blank %}
        {% comment %} é¢œè‰²å®‰å…¨æå–é€»è¾‘ {% endcomment %}
        {% assign safe_color = room.theme_color.value | default: room.theme_color | default: '#D4AF37' %}
        {% assign theme_color_str = safe_color | append: '' %}
        
        {% assign opacity_alpha = section.settings.glow_opacity | divided_by: 100.0 %}
        {% assign theme_glow = theme_color_str | color_modify: 'alpha', opacity_alpha %}
        {% assign theme_dim = theme_color_str | color_modify: 'alpha', 0.2 %}
        
        {% comment %} éšæœºå‘¼å¸èŠ‚å¥ {% endcomment %}
        {% assign random_salt = forloop.index | times: 17 %}
        {% assign random_seed = "now" | date: "%N" | plus: random_salt | modulo: 5 | plus: 3 %}

        <a href="{{ room.system.url }}" 
           class="chamber-card {% if section.settings.enable_arch_shape %}is-arch{% endif %} {% if section.settings.enable_deco_border %}has-deco{% endif %}"
           style="
             --theme-color: {{ theme_color_str }}; 
             --theme-glow: {{ theme_glow }};
             --theme-dim: {{ theme_dim }};
             --breath-duration: {{ random_seed }}s;
           ">
          
          {% if room.sigil != blank %}
            {{ room.sigil | image_url: width: 600 | image_tag: class: 'chamber-img', loading: 'lazy' }}
          {% else %}
            <div style="width:100%;height:100%;background:#111;display:flex;align-items:center;justify-content:center;color:#333;font-size:10px;">NO VISUAL</div>
          {% endif %}
          
          <div class="chamber-info">
            <div class="chamber-sigil-icon">âœ¦</div>
            <div class="chamber-name">
              {{ block.settings.custom_label | default: room.name }}
            </div>
          </div>
          
        </a>
      {% endif %}
    {% endfor %}

  </div>
</div>
